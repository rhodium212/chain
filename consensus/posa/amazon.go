package posa

import (
	"math/big"

	"github.com/ethereum/go-ethereum/common"
)

//
// The Amazon Hardfork includes the following upgrades:
//   - KCC Staking Contract: Add a new method to migrate GoDao's KCS
//   - KCC Peg Token: Add a method to migrate tokens
//   - Consensus: Reduce reorged blocks
//

type codeSetter interface {
	SetCode(addr common.Address, code []byte)
}

type AmazonPatch func(state codeSetter)

func GetAmazonPatches(chainID *big.Int) []AmazonPatch {

	chain := new(big.Int).Set(chainID)

	return []AmazonPatch{
		patchKCCStaking,
		func(state codeSetter) {
			patchKCCPegToken(chain, state)
		},
	}
}

// The patches for kcc staking:
//   - upgrade the staking contract code to commit "#3712140"
//
// This patch is the same for both mainnet and testnet
func patchKCCStaking(state codeSetter) {

	newCode := common.FromHex("0x6080604052600436106103fe5760003560e01c8063967945c711610213578063c457865811610123578063d6c0edad116100ab578063ee16442e1161007a578063ee16442e14610b9e578063f1143a4614610bbe578063f165629614610bde578063f851a44014610bfe578063fd2d4b6a14610c135761043e565b8063d6c0edad14610b57578063dbff2dfd14610b5f578063e5a99f4f14610b74578063edf4a3c314610b895761043e565b8063c6a84c03116100f2578063c6a84c0314610ab7578063c76f8d4014610ad7578063ce3d1daf14610af7578063d084029814610b17578063d279c19114610b375761043e565b8063c457865814610a4d578063c46102cc14610a6d578063c531869d14610a8d578063c53aabf714610aa25761043e565b8063a8bc58f2116101a6578063badca81911610175578063badca819146109ab578063bbb9e4d1146109cb578063beb2291a146109e0578063c2657c4d14610a0d578063c3d117bf14610a2d5761043e565b8063a8bc58f214610941578063afeea11514610956578063b21dfed21461096b578063b7c131351461098b5761043e565b80639e83513d116101e25780639e83513d146108d7578063a0dc2758146108ec578063a2340d3714610901578063a4bfe259146109215761043e565b8063967945c7146108555780639ced7e76146108755780639d771a04146108955780639de70258146108b55761043e565b80635463080f1161030e57806361167fe7116102a157806379c728501161027057806379c72850146107cd5780637c01f053146107e0578063862fab4214610800578063863a20b7146108205780638f283970146108355761043e565b806361167fe71461075857806369ee53fa146107785780636dd7d8ea14610798578063714897df146107ab5761043e565b80635b337c2c116102dd5780635b337c2c146106ee5780635bcee3821461070e57806360b1d7281461072e57806360c80cbf146107435761043e565b80635463080f1461066e578063567133431461068e5780635785a619146106ae5780635b16ebb7146106ce5761043e565b80632e011c1e1161039157806340550a1c1161036057806340550a1c146105e457806346f7513814610604578063496188e2146106195780634a9b826a1461062e57806351cff8d91461064e5761043e565b80632e011c1e1461056057806333ad1e011461058f5780633619e9c3146105af5780633c3000ba146105cf5761043e565b806318e018dc116103cd57806318e018dc146104de578063205f51801461050b57806323382609146105205780632687e03a146105405761043e565b80630c65f52c146104435780630f208beb146104585780631399a66d1461048f57806314f64c78146104b15761043e565b3661043e577f23d6854f607f94ebfa6016da2a230f6517948e27c51aa087451196d47ddf69283334604051610434929190615724565b60405180910390a1005b600080fd5b61045661045136600461526c565b610c33565b005b34801561046457600080fd5b50610478610473366004615287565b610e17565b6040516104869291906164d8565b60405180910390f35b34801561049b57600080fd5b506104a4610e3b565b6040516104869190615815565b3480156104bd57600080fd5b506104d16104cc3660046155db565b610e44565b6040516104869190615710565b3480156104ea57600080fd5b506104fe6104f936600461526c565b610e6b565b60405161048691906164bf565b34801561051757600080fd5b506104fe610e8d565b34801561052c57600080fd5b506104d161053b36600461526c565b610e93565b34801561054c57600080fd5b506104fe61055b36600461526c565b610eb4565b34801561056c57600080fd5b5061058061057b36600461526c565b610ed2565b60405161048693929190615833565b34801561059b57600080fd5b506104566105aa366004615382565b6110a3565b3480156105bb57600080fd5b506104fe6105ca36600461526c565b6110db565b3480156105db57600080fd5b506104fe6110f9565b3480156105f057600080fd5b506104a46105ff36600461526c565b6110ff565b34801561061057600080fd5b506104d161115a565b34801561062557600080fd5b506104fe611169565b34801561063a57600080fd5b506104a461064936600461562e565b61116f565b34801561065a57600080fd5b5061045661066936600461526c565b61118f565b34801561067a57600080fd5b506104566106893660046155db565b611234565b34801561069a57600080fd5b506104a46106a936600461526c565b6112c0565b3480156106ba57600080fd5b506104a46106c93660046155db565b6112e1565b3480156106da57600080fd5b506104a46106e936600461526c565b6112f6565b3480156106fa57600080fd5b506104566107093660046155db565b611316565b34801561071a57600080fd5b50610456610729366004615479565b611397565b34801561073a57600080fd5b506104fe611443565b34801561074f57600080fd5b506104d1611449565b34801561076457600080fd5b506104fe61077336600461526c565b611458565b34801561078457600080fd5b506104fe61079336600461526c565b611476565b6104566107a636600461526c565b611494565b3480156107b757600080fd5b506107c06115cd565b60405161048691906164b0565b6104566107db3660046152bb565b6115d2565b3480156107ec57600080fd5b506104566107fb366004615382565b611c9f565b34801561080c57600080fd5b5061045661081b3660046153b9565b611e6f565b34801561082c57600080fd5b506104d1611fd1565b34801561084157600080fd5b5061045661085036600461526c565b611fe0565b34801561086157600080fd5b506104fe61087036600461526c565b61202c565b34801561088157600080fd5b506104fe610890366004615287565b61204a565b3480156108a157600080fd5b506104566108b036600461526c565b61205f565b3480156108c157600080fd5b506108ca61211c565b604051610486919061573d565b3480156108e357600080fd5b506104fe61217f565b3480156108f857600080fd5b506104fe612185565b34801561090d57600080fd5b506104fe61091c36600461526c565b61218b565b34801561092d57600080fd5b5061045661093c36600461560b565b6121a9565b34801561094d57600080fd5b506104fe6122ff565b34801561096257600080fd5b506108ca612305565b34801561097757600080fd5b506108ca61098636600461526c565b612416565b34801561099757600080fd5b506104566109a63660046154b9565b6124e2565b3480156109b757600080fd5b506104a46109c6366004615287565b61292c565b3480156109d757600080fd5b506104fe612993565b3480156109ec57600080fd5b50610a006109fb36600461526c565b612999565b604051610486919061578a565b348015610a1957600080fd5b506104fe610a2836600461526c565b612c1d565b348015610a3957600080fd5b50610456610a483660046155db565b612c3b565b348015610a5957600080fd5b50610456610a6836600461544f565b612cbc565b348015610a7957600080fd5b50610456610a8836600461526c565b612e9d565b348015610a9957600080fd5b506104fe612f52565b348015610aae57600080fd5b50610456612f5e565b348015610ac357600080fd5b50610456610ad236600461526c565b612ff4565b348015610ae357600080fd5b50610478610af2366004615287565b61313c565b348015610b0357600080fd5b506104fe610b1236600461526c565b613160565b348015610b2357600080fd5b506104fe610b3236600461526c565b61317e565b348015610b4357600080fd5b50610456610b5236600461526c565b61319c565b6104566131db565b348015610b6b57600080fd5b506104fe61359b565b348015610b8057600080fd5b506104d16135a1565b348015610b9557600080fd5b506104fe6135b0565b348015610baa57600080fd5b50610456610bb936600461544f565b6135b6565b348015610bca57600080fd5b50610456610bd93660046155db565b613620565b348015610bea57600080fd5b506104fe610bf936600461526c565b6136a1565b348015610c0a57600080fd5b506104d16136bf565b348015610c1f57600080fd5b50610456610c2e3660046155db565b6136ce565b603854600160a01b900460ff16610c655760405162461bcd60e51b8152600401610c5c906162ec565b60405180910390fd5b6038805460ff60a01b191690553415801590610c905750610c8e34670de0b6b3a764000061374f565b155b610cac5760405162461bcd60e51b8152600401610c5c90615aaa565b6000610cc034670de0b6b3a7640000613791565b6001600160a01b03838116600090815260776020526040902060010154919250163314610cff5760405162461bcd60e51b8152600401610c5c90615d53565b6001600160a01b0382166000908152607760205260409020600281015415610d2a57610d2a836137d3565b6002810154610d39908361387a565b60028201819055600a820154610d5f9164e8d4a5100091610d599161389f565b90613791565b60038201556009810154610d73908361387a565b6009820155606a54610d85908361387a565b606a55606f54600282015410801590610da25750600d81015460ff165b15610db457610db460706077856138d9565b826001600160a01b0316336001600160a01b03167ff297865ac57d5e90b6602e368c1ee6df8104228d78fce8ed8923b48a9694796434604051610df791906164bf565b60405180910390a350506038805460ff60a01b1916600160a01b17905550565b607a6020908152600092835260408084209091529082529020805460019091015482565b607f5460ff1681565b607e8181548110610e5157fe5b6000918252602090912001546001600160a01b0316905081565b6001600160a01b0381166000908152607760205260409020600601545b919050565b606b5481565b6001600160a01b039081166000908152607760205260409020600101541690565b6001600160a01b031660009081526077602052604090206005015490565b60786020908152600091825260409182902080548351601f60026000196101006001861615020190931692909204918201849004840281018401909452808452909291839190830182828015610f695780601f10610f3e57610100808354040283529160200191610f69565b820191906000526020600020905b815481529060010190602001808311610f4c57829003601f168201915b505050505090806001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156110075780601f10610fdc57610100808354040283529160200191611007565b820191906000526020600020905b815481529060010190602001808311610fea57829003601f168201915b50505060028085018054604080516020601f60001961010060018716150201909416959095049283018590048502810185019091528181529596959450909250908301828280156110995780601f1061106e57610100808354040283529160200191611099565b820191906000526020600020905b81548152906001019060200180831161107c57829003601f168201915b5050505050905083565b6038546001600160a01b031633146110cd5760405162461bcd60e51b8152600401610c5c90615968565b6110d78282613c3f565b5050565b6001600160a01b031660009081526077602052604090206007015490565b606e5481565b6000805b607e5481101561115157826001600160a01b0316607e828154811061112457fe5b6000918252602090912001546001600160a01b03161415611149576001915050610e88565b600101611103565b50600092915050565b6033546001600160a01b031681565b610bb881565b607660209081526000928352604080842090915290825290205460ff1681565b603854600160a01b900460ff166111b85760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b19169055336001600160a01b03821614156111ee5760405162461bcd60e51b8152600401610c5c906163f5565b6111f8338261292c565b6112145760405162461bcd60e51b8152600401610c5c90616452565b61121e3382613cd4565b506038805460ff60a01b1916600160a01b179055565b6038546001600160a01b0316331461125e5760405162461bcd60e51b8152600401610c5c90615968565b606e548114156112805760405162461bcd60e51b8152600401610c5c906160c4565b606e8190556040517fd045295f12ef4f160f8803b90edaa025c769d65531eab370dc395fc297ac5ac7906112b59083906164bf565b60405180910390a150565b6001600160a01b03166000908152607760205260409020600d015460ff1690565b60796020526000908152604090205460ff1681565b6001600160a01b0390811660009081526077602052604090205416151590565b6038546001600160a01b031633146113405760405162461bcd60e51b8152600401610c5c90615968565b606b548114156113625760405162461bcd60e51b8152600401610c5c906160c4565b606b8190556040517fb1af0e731cd364da26a491d6c9e37100decbf030b0f444b8eb3601dfec2ade3a906112b59083906164bf565b3341146113b65760405162461bcd60e51b8152600401610c5c90615f8d565b60375443816113c157fe5b06156113df5760405162461bcd60e51b8152600401610c5c90615a49565b43600090815260766020908152604080832060018085529252909120805460ff1916909117905580158015906114165750601d8111155b6114325760405162461bcd60e51b8152600401610c5c90615e88565b61143e607e8383614f9a565b505050565b606d5481565b6036546001600160a01b031681565b6001600160a01b031660009081526077602052604090206003015490565b6001600160a01b03166000908152607760205260409020600b015490565b603854600160a01b900460ff166114bd5760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b191690556001600160a01b0381166000908152607760205260409020606f54600282015410156115085760405162461bcd60e51b8152600401610c5c90616241565b336001600160a01b03831614156115315760405162461bcd60e51b8152600401610c5c906163f5565b600061154534670de0b6b3a7640000613791565b90506000341180156115575750600081115b6115735760405162461bcd60e51b8152600401610c5c90615aaa565b600061158782670de0b6b3a764000061389f565b905060006115953483613dda565b90506115a333868587613e1c565b80156115b3576115b38133613fc0565b50506038805460ff60a01b1916600160a01b179055505050565b601d81565b603854600160a01b900460ff166115fb5760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b1916905561161a34670de0b6b3a764000061374f565b156116375760405162461bcd60e51b8152600401610c5c906160fb565b60008581526079602052604090205460ff16156116665760405162461bcd60e51b8152600401610c5c906162b5565b60008581526079602052604090819020805460ff1916600117905560355490516377f085c560e01b81526001600160a01b03909116906377f085c5906116b2908a908990600401615724565b60206040518083038186803b1580156116ca57600080fd5b505afa1580156116de573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061170291906155bf565b61171e5760405162461bcd60e51b8152600401610c5c90615ebf565b6038546001600160a01b031633148061173f5750336001600160a01b038816145b61175b5760405162461bcd60e51b8152600401610c5c9061598f565b6001600160a01b0387166117815760405162461bcd60e51b8152600401610c5c9061608d565b610bb88411156117a35760405162461bcd60e51b8152600401610c5c90615f30565b6001600160a01b0387166000908152607760205260409020600d015460ff16156117df5760405162461bcd60e51b8152600401610c5c906163be565b60006117f334670de0b6b3a7640000613791565b6001600160a01b03808a16600081815260776020526040902054929350911614156119ba576001600160a01b0388166000908152607760205260409020606f5460028201541061184657611846896137d3565b6001600160a01b0388166000908152607d60205260409020611868908a61407d565b506002810154611878908361387a565b60028201819055600a8201546118989164e8d4a5100091610d599161389f565b600382015560098101546118ac908361387a565b6009820155600d81018054600160ff199091168117909155810180546001600160a01b0319166001600160a01b038a81169190911790915589166000908152607860209081526040909120855161190592870190614ffd565b506001600160a01b0389166000908152607860209081526040909120845161193592600190920191860190614ffd565b506001600160a01b0389166000908152607860209081526040909120865161196592600290920191880190614ffd565b50876001600160a01b0316896001600160a01b03167f01afec26da4639ca59757acff9f9c2774466c95095a1d87e4aec0379871997eb8860016040516119ac9291906164c8565b60405180910390a350611c41565b604051806101c00160405280896001600160a01b03168152602001886001600160a01b03168152602001828152602001600081526020018681526020016000815260200160008152602001438152602001611a20606c544261387a90919063ffffffff16565b815260200182815260200160008152602001600081526020016000815260200160011515815250607760008a6001600160a01b03166001600160a01b0316815260200190815260200160002060008201518160000160006101000a8154816001600160a01b0302191690836001600160a01b0316021790555060208201518160010160006101000a8154816001600160a01b0302191690836001600160a01b0316021790555060408201518160020155606082015181600301556080820151816004015560a0820151816005015560c0820151816006015560e082015181600701556101008201518160080155610120820151816009015561014082015181600a015561016082015181600b015561018082015181600c01556101a082015181600d0160006101000a81548160ff021916908315150217905550905050604051806060016040528084815260200183815260200185815250607860008a6001600160a01b03166001600160a01b031681526020019081526020016000206000820151816000019080519060200190611bb9929190614ffd565b506020828101518051611bd29260018501920190614ffd565b5060408201518051611bee916002840191602090910190614ffd565b50905050866001600160a01b0316886001600160a01b03167f01afec26da4639ca59757acff9f9c2774466c95095a1d87e4aec0379871997eb876000604051611c389291906164c8565b60405180910390a35b606f546001600160a01b03891660009081526077602052604090206002015410611c7257611c72607060778a6138d9565b606a54611c7f908261387a565b606a5550506038805460ff60a01b1916600160a01b179055505050505050565b6034546001600160a01b03163314611cc95760405162461bcd60e51b8152600401610c5c90616213565b8015611cda57611cda826000613c3f565b606e546001600160a01b038316600090815260776020526040812060038101546002820154600a830154929392611d279291611d219164e8d4a5100091610d59919061389f565b90613dda565b9050600083836005015410611d65576005830154611d459085613dda565b60058401556006830154611d59908561387a565b60068401555082611e0f565b6000611d7e846005015486613dda90919063ffffffff16565b9050611d9784600501548361387a90919063ffffffff16565b9150611db48460050154856006015461387a90919063ffffffff16565b600685015560006005850155808310611dec576003840154611dd6908261387a565b6003850155611de5828261387a565b9150611e0d565b6003840154611dfb908461387a565b6003850155611e0a828461387a565b91505b505b603654611e25906001600160a01b031682614092565b43866001600160a01b03167f05599b2455d2edd13c543d8ec4cee26e688c66fce9029652baa0abdfcecda43583604051611e5f91906164bf565b60405180910390a3505050505050565b6038546001600160a01b03163314611e995760405162461bcd60e51b8152600401610c5c90615968565b610bb883511115611ebc5760405162461bcd60e51b8152600401610c5c90615d1c565b606482511115611ede5760405162461bcd60e51b8152600401610c5c90616288565b603281511115611f005760405162461bcd60e51b8152600401610c5c90615e5d565b6001600160a01b038416600090815260786020526040902080600201604051611f2991906156a0565b6040518091039020848051906020012014611f55578351611f539060028301906020870190614ffd565b505b604051611f639082906156a0565b6040518091039020838051906020012014611f8c578251611f8a9082906020860190614ffd565b505b80600101604051611f9d91906156a0565b6040518091039020828051906020012014611fc9578151611fc79060018301906020850190614ffd565b505b505b50505050565b6035546001600160a01b031681565b6038546001600160a01b0316331461200a5760405162461bcd60e51b8152600401610c5c90615968565b603880546001600160a01b0319166001600160a01b0392909216919091179055565b6001600160a01b031660009081526077602052604090206008015490565b6000612056838361412e565b90505b92915050565b603854600160a01b900460ff166120885760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b191690556001600160a01b0380821660008181526077602052604090208054909216146120d05760405162461bcd60e51b8152600401610c5c90615942565b60018101546001600160a01b031633146120fc5760405162461bcd60e51b8152600401610c5c90616046565b612105826137d3565b50506038805460ff60a01b1916600160a01b179055565b6060607e80548060200260200160405190810160405280929190818152602001828054801561217457602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311612156575b505050505090505b90565b606c5481565b60375481565b6001600160a01b031660009081526077602052604090206004015490565b6001600160a01b038181166000908152607760205260409020600181015490911633146121e85760405162461bcd60e51b8152600401610c5c906161b1565b600d81015460ff1661220c5760405162461bcd60e51b8152600401610c5c9061614d565b80546001600160a01b03166122335760405162461bcd60e51b8152600401610c5c90615c6b565b610bb88311156122555760405162461bcd60e51b8152600401610c5c90615f30565b80600801544210156122795760405162461bcd60e51b8152600401610c5c90615db1565b806004015483141561229d5760405162461bcd60e51b8152600401610c5c9061617a565b60048101839055606c546122b290429061387a565b60088201556040516001600160a01b038316907f3b72e0b66d7c778f32dd63a45b08880ca99a150c9d330e5c5a7065ae70030d3e906122f29086906164bf565b60405180910390a2505050565b60755481565b6060600061231d601d61ffff1660706002015461426a565b90508061233a57505060408051600081526020810190915261217c565b60608167ffffffffffffffff8111801561235357600080fd5b5060405190808252806020026020018201604052801561237d578160200160208202803683370190505b5060705481519192506001600160a01b0316908190839060009061239d57fe5b6001600160a01b039092166020928302919091019091015260015b8381101561240d576001600160a01b03918216600090815260746020526040902054835192169182908490839081106123ed57fe5b6001600160a01b03909216602092830291909101909101526001016123b8565b50909250505090565b6001600160a01b0381166000908152607d6020526040812060609161243a82614280565b905060608167ffffffffffffffff8111801561245557600080fd5b5060405190808252806020026020018201604052801561247f578160200160208202803683370190505b5090506000805b838110156124d757600061249a868361428b565b9050808484815181106124a957fe5b6001600160a01b03909216602092830291909101909101526124cc83600161387a565b925050600101612486565b509095945050505050565b600054610100900460ff16806124fb57506124fb614297565b80612509575060005460ff16155b6125255760405162461bcd60e51b8152600401610c5c90615fb1565b600054610100900460ff16158015612550576000805460ff1961ff0019909116610100171660011790555b8b8814801561255e57508b8a145b801561256957508b15155b6125855760405162461bcd60e51b8152600401610c5c90615900565b6203f480606b556213c680606d5562015180606c5568056bc75e2d63100000606e55612710606f8190556125cd90670de0b6b3a7640000906125c7908f61389f565b9061389f565b4710156125ec5760405162461bcd60e51b8152600401610c5c90615afe565b6125f58761429d565b612602868686868661433b565b61260a614411565b60005b8c8110156128875760008e8e8381811061262357fe5b9050602002016020810190612638919061526c565b905060008b8b8481811061264857fe5b6001600160a01b03851660009081526077602090815260409091209102929092013592508f90508e8581811061267a57fe5b905060200201602081019061268f919061526c565b6001820180546001600160a01b03199081166001600160a01b0393841617909155825416908416178155606f546002820155600481018290556000600582018190556006820155436007820155606c546126ea90429061387a565b6008820155606f5460098201556000600a8201819055600b8201819055600c8201819055600d8201805460ff191660011790556001600160a01b0384168152607860209081526040808320815192830191829052918390529091612752916002840191614ffd565b50604080516020810191829052600090819052612773916001840191614ffd565b50604080516020810191829052600090819052612791918391614ffd565b5061279f60706077866138d9565b607e54601d11156127f657607e80546001810182556000919091527f0f2ada1f2dbae48ae468fe0cdb7bcda7d0cffee8545442e682273ba01a6203a70180546001600160a01b0319166001600160a01b0386161790555b6009820154606a546128079161387a565b606a558f8f8681811061281657fe5b905060200201602081019061282b919061526c565b6001600160a01b0316846001600160a01b03167f01afec26da4639ca59757acff9f9c2774466c95095a1d87e4aec0379871997eb8560006040516128709291906164c8565b60405180910390a35050505080600101905061260d565b5060005b8c81101561290a57612901607d60008e8e858181106128a657fe5b90506020020160208101906128bb919061526c565b6001600160a01b03166001600160a01b031681526020019081526020016000208f8f848181106128e757fe5b90506020020160208101906128fc919061526c565b61407d565b5060010161288b565b50801561291d576000805461ff00191690555b50505050505050505050505050565b6000612936615077565b506001600160a01b038084166000908152607b6020908152604080832093861683529281529082902082518084019093528054808452600190910154918301919091521580159061298b575080602001514210155b949350505050565b606f5481565b6001600160a01b0381166000908152607c602052604081206060916129bd82614280565b90508067ffffffffffffffff811180156129d657600080fd5b50604051908082528060200260200182016040528015612a1057816020015b6129fd615091565b8152602001906001900390816129f55790505b5092506000805b82811015612c14576000612a2b858361428b565b9050612a356150d7565b506001600160a01b0380821660009081526077602090815260409182902082516101c0810184528154851681526001820154909416918401919091526002810154918301919091526003810154606083015260048101546080830152600581015460a0830152600681015460c0830152600781015460e083015260088101546101008301526009810154610120830152600a810154610140830152600b810154610160830152600c810154610180830152600d015460ff1615156101a0820152612afd615077565b506001600160a01b038083166000908152607a60209081526040808320938c168352928152908290208251808401909352805483526001015490820152612b42615077565b506001600160a01b03808a166000908152607b6020908152604080832093871683529281528282208351808501909452805484526001015490830152612b88858c61412e565b90506040518060e0016040528085600001516001600160a01b03168152602001856101200151815260200185608001518152602001846000015181526020018281526020018360000151815260200183602001518152508a8881518110612beb57fe5b6020908102919091010152612c0187600161387a565b96505060019094019350612a1792505050565b50505050919050565b6001600160a01b031660009081526077602052604090206002015490565b6038546001600160a01b03163314612c655760405162461bcd60e51b8152600401610c5c90615968565b606f54811415612c875760405162461bcd60e51b8152600401610c5c906160c4565b606f8190556040517faa013f7784cb6a7e4b908ae680fb75d44d826bcec005582a91d91cc8eba9c5f8906112b59083906164bf565b603854600160a01b900460ff16612ce55760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b1916905580612d0f5760405162461bcd60e51b8152600401610c5c9061636e565b6001600160a01b03828116600090815260776020526040902060010154163314612d4b5760405162461bcd60e51b8152600401610c5c90615d53565b6001600160a01b03821660009081526077602052604090206002810154821115612d875760405162461bcd60e51b8152600401610c5c90615b42565b612d90836137d3565b612d9a838461292c565b15612da857612da83361449b565b6009810154612db78184613dda565b6009830155606a54612dc99084613dda565b606a556002820154612ddb9084613dda565b60028301819055600a830154612dfb9164e8d4a5100091610d599161389f565b6003830155606f5460028301541015612e1e57612e196070856144d6565b612e2b565b612e2b60706077866146a9565b612e39848585606d54614919565b836001600160a01b0316336001600160a01b03167f25f15cdd571a1fdd95de770368cf68023dc79c8d2d4a0f35208a3b0b07bf23bc85604051612e7c91906164bf565b60405180910390a350506038805460ff60a01b1916600160a01b1790555050565b603854600160a01b900460ff16612ec65760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b191690556001600160a01b038082166000818152607760205260409020805490921614612f0e5760405162461bcd60e51b8152600401610c5c90615942565b60018101546001600160a01b03163314612f3a5760405162461bcd60e51b8152600401610c5c90615b79565b612f44828361292c565b15612105576121058261449b565b670de0b6b3a764000081565b6038546001600160a01b03163314612f885760405162461bcd60e51b8152600401610c5c90615968565b607f5460ff1615612fab5760405162461bcd60e51b8152600401610c5c906161e8565b607f805460ff1916600117905546610142811415612fdc57670de0b6b3a7640000612fd63382614092565b50612ff1565b69d1a401ee0332eec000006110d73382614092565b50565b603854600160a01b900460ff1661301d5760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b191690556001600160a01b0380821660008181526077602052604090208054909216146130655760405162461bcd60e51b8152600401610c5c90615942565b60018101546001600160a01b031633146130915760405162461bcd60e51b8152600401610c5c906159ec565b60008160050154116130b55760405162461bcd60e51b8152600401610c5c90616323565b600581018054600090915560068201546130cf908261387a565b60068301556130de8133613fc0565b81546040516001600160a01b03909116907fa847ccfc1c24e1b6493e19c018745f8e9f60288140e209713efc58517bfc0ce39061311c9084906164bf565b60405180910390a250506038805460ff60a01b1916600160a01b17905550565b607b6020908152600092835260408084209091529082529020805460019091015482565b6001600160a01b03166000908152607760205260409020600a015490565b6001600160a01b031660009081526077602052604090206009015490565b603854600160a01b900460ff166131c55760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b1916905561121e8161499e565b3341146131fa5760405162461bcd60e51b8152600401610c5c90615f8d565b603854600160a01b900460ff166132235760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b1916905543600090815260766020908152604080832083805290915290205460ff161561326b5760405162461bcd60e51b8152600401610c5c90615c1a565b4360009081526076602090815260408083208380528252808320805460ff19166001179055603654815163cf813c1d60e01b815291516001600160a01b039091169263cf813c1d926004808201939182900301818787803b1580156132cf57600080fd5b505af11580156132e3573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061330791906155f3565b9050806133145750613586565b60008061332c8360755461387a90919063ffffffff16565b607e5490915060009015613554576000805b607e5460ff821610156133f957600060776000607e8460ff168154811061336157fe5b60009182526020808320909101546001600160a01b031683528201929092526040019020606f546002820154919250118015906133a25750600d81015460ff165b156133f0576133ed60776000607e8560ff16815481106133be57fe5b60009182526020808320909101546001600160a01b03168352820192909252604001902060090154849061387a565b92505b5060010161333e565b50801561355257600061340c8483613791565b905060005b607e5460ff8216101561354f57600060776000607e8460ff168154811061343457fe5b60009182526020808320909101546001600160a01b031683528201929092526040019020606f54600282015491925011806134745750600d81015460ff16155b1561347f5750613547565b600061349882600901548561389f90919063ffffffff16565b905060006134b9612710610d5985600401548561389f90919063ffffffff16565b60058401549091506134cb908261387a565b600584015560006134dc8383613dda565b905061350c6135018560090154610d5964e8d4a510008561389f90919063ffffffff16565b600a8601549061387a565b600a85015561351b888461387a565b436007860155600c85015490985061353490600161387a565b600c909401939093555050600190960195505b600101613411565b50505b505b808210156135745760405162461bcd60e51b8152600401610c5c90615e00565b61357e8282613dda565b607555505050505b6038805460ff60a01b1916600160a01b179055565b61271081565b6034546001600160a01b031681565b606a5481565b603854600160a01b900460ff166135df5760405162461bcd60e51b8152600401610c5c906162ec565b6038805460ff60a01b19169055336001600160a01b03831614156136155760405162461bcd60e51b8152600401610c5c906163f5565b612105338383614a74565b6038546001600160a01b0316331461364a5760405162461bcd60e51b8152600401610c5c90615968565b606d5481141561366c5760405162461bcd60e51b8152600401610c5c906160c4565b606d8190556040517f6fff7f86bcaae80aa63d8c5380045b255699fbf83b399caec3278c8cccb82263906112b59083906164bf565b6001600160a01b03166000908152607760205260409020600c015490565b6038546001600160a01b031681565b6038546001600160a01b031633146136f85760405162461bcd60e51b8152600401610c5c90615968565b606c5481141561371a5760405162461bcd60e51b8152600401610c5c906160c4565b606c8190556040517f836d4870c480e504f7e59c68ff0ab6582d14af4475c2a66c16a8f2a0b6c3fd9b906112b59083906164bf565b600061205683836040518060400160405280601881526020017f536166654d6174683a206d6f64756c6f206279207a65726f0000000000000000815250614bf7565b600061205683836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f000000000000815250614c2b565b6001600160a01b0381166000908152607760205260408120906137f583614c62565b905080156138165760018201546138169082906001600160a01b0316613fc0565b61383a64e8d4a51000610d5984600a0154856002015461389f90919063ffffffff16565b60038301556040516001600160a01b038416907fef89e1a1006e92f5c35aeca19e2099abded5e99c36b1f1dcdd7131398794c325906122f29084906164bf565b6000828201838110156120565760405162461bcd60e51b8152600401610c5c90615a73565b6000826138ae57506000612059565b828202828482816138bb57fe5b04146120565760405162461bcd60e51b8152600401610c5c90615eef565b600283015461391e5782546001600160a01b0382166001600160a01b03199182168117855560018086018054909316909117909155600284018054909101905561143e565b82546001600160a01b03828116911614156139385761143e565b6001600160a01b0380821660009081526003850160205260409020541680613a0c5760028401805460019081019091558401546001600160a01b03908116600090815260208590526040808220600990810154938616835291200154116139f857506001830180546001600160a01b038381166000818152600388016020908152604080832080549686166001600160a01b031997881617905586549094168252600489019052919091208054831682179055825490911617905561143e565b5060018301546001600160a01b0316613af1565b6001600160a01b0380821660009081526020859052604080822060099081015493861683529120015411613a40575061143e565b6001600160a01b038083166000818152600487016020526040808220548585168352912080546001600160a01b03191691841691909117905560018601549091161415613aa9576001840180546001600160a01b0319166001600160a01b038316179055613af1565b6001600160a01b03808316600090815260038601602081815260408084205460048a01835281852054861685529290915290912080546001600160a01b031916919092161790555b5b6001600160a01b03811615801590613b3057506001600160a01b03808216600090815260208590526040808220600990810154938616835291200154115b15613b57576001600160a01b03908116600090815260038501602052604090205416613af2565b6001600160a01b038116613bcb5783546001600160a01b038381166000818152600488016020908152604080832080549686166001600160a01b0319978816179055895490941682526003890190528281208054851683179055818152919091208054831690558554909116178455611fcb565b6001600160a01b0390811660008181526004860160209081526040808320805496861680855282852080549888166001600160a01b0319998a161790558154909616845260039098019091528082208054861685179055865485168417909655918252939020805490911690921790915550565b6001600160a01b0382166000908152607760205260409020600d81015460ff16151582151514613c9b57600d8101805460ff191683151517905581613c8e57613c896070846144d6565b613c9b565b613c9b60706077856138d9565b826001600160a01b03167f2f62a1a1d6859de456dd8107c09e738da088ceb9f87d90c2e31f91fb3e89b727836040516122f29190615815565b6001600160a01b038083166000908152607b60209081526040808320938516835292905220613d01615077565b506001600160a01b038083166000908152607a60209081526040808320938716835292815282822083518085019094528054845260010154908301528254908355613d5d613d5782670de0b6b3a764000061389f565b33613fc0565b8151613d88576001600160a01b0385166000908152607c60205260409020613d858186614d53565b50505b836001600160a01b0316856001600160a01b03167f9b1bfa7fa9ee420a16e124f794c35ac9f90472acc99140eb2f6447c714cad8eb83604051613dcb91906164bf565b60405180910390a35050505050565b600061205683836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250614d68565b6001600160a01b038084166000908152607a60209081526040808320938816835292905220805415613eb8576000613e54858761412e565b90508015613eb257613e668133613fc0565b846001600160a01b0316866001600160a01b03167f7e77f685b38c861064cb08f2776eb5dfd3c82f652ed9f21221b8c53b75628e5183604051613ea991906164bf565b60405180910390a35b50613ef2565b600b820154613ec890600161387a565b600b8301556001600160a01b0385166000908152607c60205260409020613eef818661407d565b50505b8054613efe908461387a565b808255600a830154613f1b9164e8d4a5100091610d59919061389f565b60018201556009820154613f2f908461387a565b6009830155606a54613f41908461387a565b606a55606f54600283015410801590613f5e5750600d82015460ff165b15613f7d578154613f7d906070906077906001600160a01b03166138d9565b836001600160a01b0316856001600160a01b03167f66a9138482c99e9baf08860110ef332cc0c23b4a199a53593d8db0fc8f96fbfc85604051613dcb91906164bf565b478083111561402357613fd38282614092565b816001600160a01b0316306001600160a01b03167fa282a314ffba449688a7c5eb4426bd8e1781944ce824ce34dfaea4691d08f1468360405161401691906164bf565b60405180910390a361143e565b61402d8284614092565b816001600160a01b0316306001600160a01b03167fa282a314ffba449688a7c5eb4426bd8e1781944ce824ce34dfaea4691d08f1468560405161407091906164bf565b60405180910390a3505050565b6000612056836001600160a01b038416614d94565b804710156140b25760405162461bcd60e51b8152600401610c5c90615c98565b6000826001600160a01b0316826040516140cb9061217c565b60006040518083038185875af1925050503d8060008114614108576040519150601f19603f3d011682016040523d82523d6000602084013e61410d565b606091505b505090508061143e5760405162461bcd60e51b8152600401610c5c90615bbd565b60006141386150d7565b506001600160a01b0380841660009081526077602090815260409182902082516101c0810184528154851681526001820154909416918401919091526002810154918301919091526003810154606083015260048101546080830152600581015460a0830152600681015460c0830152600781015460e083015260088101546101008301526009810154610120830152600a810154610140830152600b810154610160830152600c810154610180830152600d015460ff1615156101a0820152614200615077565b506001600160a01b038085166000908152607a60209081526040808320938716835292815290829020825180840190935280548084526001909101549183018290526101408401516142619291611d219164e8d4a5100091610d599161389f565b95945050505050565b60008183106142795781612056565b5090919050565b600061205982614dde565b60006120568383614de2565b303b1590565b600054610100900460ff16806142b657506142b6614297565b806142c4575060005460ff16155b6142e05760405162461bcd60e51b8152600401610c5c90615fb1565b600054610100900460ff1615801561430b576000805460ff1961ff0019909116610100171660011790555b603880546001600160a01b0319166001600160a01b03841617905580156110d7576000805461ff00191690555050565b600054610100900460ff16806143545750614354614297565b80614362575060005460ff16155b61437e5760405162461bcd60e51b8152600401610c5c90615fb1565b600054610100900460ff161580156143a9576000805460ff1961ff0019909116610100171660011790555b603380546001600160a01b038089166001600160a01b0319928316179092556034805488841690831617905560358054878416908316179055603680549286169290911691909117905560378290558015611fc7576000805461ff0019169055505050505050565b600054610100900460ff168061442a575061442a614297565b80614438575060005460ff16155b6144545760405162461bcd60e51b8152600401610c5c90615fb1565b600054610100900460ff1615801561447f576000805460ff1961ff0019909116610100171660011790555b614487614e27565b8015612ff1576000805461ff001916905550565b6001600160a01b0381166000908152607b60209081526040808320909152812080549181559061143e613d5782670de0b6b3a764000061389f565b81546001600160a01b0382811691161480159061450d57506001600160a01b03818116600090815260038401602052604090205416155b15614517576110d7565b60018201546001600160a01b0382811691161415614563576001600160a01b0380821660009081526003840160205260409020546001840180546001600160a01b031916919092161790555b81546001600160a01b03828116911614156145a6576001600160a01b03808216600090815260048401602052604090205483546001600160a01b03191691161782555b6001600160a01b038082166000908152600484016020526040902054168015614601576001600160a01b038083166000908152600385016020526040808220548484168352912080546001600160a01b031916919092161790555b6001600160a01b03808316600090815260038501602052604090205416801561465c576001600160a01b038084166000908152600486016020526040808220548484168352912080546001600160a01b031916919092161790555b50506001600160a01b03166000908152600382016020908152604080832080546001600160a01b031990811690915560048501909252909120805490911690556002018054600019019055565b6001600160a01b0380821660008181526004860160205260409020546001860154908316921614806146e257506001600160a01b038116155b8061471457506001600160a01b0380831660009081526020859052604080822060099081015493851683529120015411155b1561471f575061143e565b6001600160a01b038083166000818152600387016020526040808220548585168352912080546001600160a01b031916918416919091179055855490911614156147815783546001600160a01b0319166001600160a01b0382161784556147c3565b6001600160a01b0382811660009081526003860160209081526040808320548416835260048801909152902080546001600160a01b0319169183169190911790555b5b6001600160a01b0381161580159061480257506001600160a01b03808316600090815260208590526040808220600990810154938516835291200154115b15614829576001600160a01b039081166000908152600485016020526040902054166147c4565b6001600160a01b03811661489f576001840180546001600160a01b038481166000818152600389016020908152604080832080549686166001600160a01b031997881617905560048b01909152808220805486169055855490931681529190912080548316821790558254909116179055611fcb565b6001600160a01b0390811660008181526003860160208181526040808420805487168552600490990180835281852080546001600160a01b0319908116998916998a179091558484528a54898752838720805491909916908216179097558252832080548616851790559290915290528354161790915550565b6001600160a01b038085166000908152607b60209081526040808320938716835292905220805461494a908461387a565b8155614956428361387a565b6001820181905581546040516001600160a01b0380881693908916927fd6f80c7d68e3e62bd7a51c3d37e575c1cfbc311c07487b69ef4eb570bc21cb6892613dcb92906164d8565b6001600160a01b0381166000908152607a60209081526040808320338085529252822091906149ce90849061412e565b9050600081116149f05760405162461bcd60e51b8152600401610c5c90615fff565b6001600160a01b0383166000908152607760205260409020600a01548254614a229164e8d4a5100091610d599161389f565b6001830155614a318133613fc0565b826001600160a01b0316336001600160a01b03167f7e77f685b38c861064cb08f2776eb5dfd3c82f652ed9f21221b8c53b75628e518360405161407091906164bf565b60008111614a945760405162461bcd60e51b8152600401610c5c90615ccf565b6001600160a01b038083166000908152607760209081526040808320607a83528184209488168452939091529020805483811015614ae45760405162461bcd60e51b8152600401610c5c90615876565b6000614af0868861412e565b90508015614b4e57614b028133613fc0565b856001600160a01b0316876001600160a01b03167f7e77f685b38c861064cb08f2776eb5dfd3c82f652ed9f21221b8c53b75628e5183604051614b4591906164bf565b60405180910390a35b614b58878761292c565b15614b6757614b678787613cd4565b6009840154614b769086613dda565b6009850155614b858286613dda565b808455600a850154614ba29164e8d4a5100091610d59919061389f565b6001840155606a54614bb49086613dda565b606a558254614bd357600b840154614bcd906001613dda565b600b8501555b614be1878787606b54614919565b614bee60706077886146a9565b50505050505050565b60008183614c185760405162461bcd60e51b8152600401610c5c9190615820565b50828481614c2257fe5b06949350505050565b60008183614c4c5760405162461bcd60e51b8152600401610c5c9190615820565b506000838581614c5857fe5b0495945050505050565b6000614c6c6150d7565b506001600160a01b0380831660009081526077602090815260409182902082516101c081018452815485168152600182015490941691840191909152600281015491830182905260038101546060840181905260048201546080850152600582015460a0850152600682015460c0850152600782015460e085015260088201546101008501526009820154610120850152600a8201546101408501819052600b830154610160860152600c830154610180860152600d9092015460ff1615156101a0850152614d4c929091611d219164e8d4a5100091610d59919061389f565b9392505050565b6000612056836001600160a01b038416614ebc565b60008184841115614d8c5760405162461bcd60e51b8152600401610c5c9190615820565b505050900390565b6000614da08383614f82565b614dd657508154600181810184556000848152602080822090930184905584548482528286019093526040902091909155612059565b506000612059565b5490565b81546000908210614e055760405162461bcd60e51b8152600401610c5c906158be565b826000018281548110614e1457fe5b9060005260206000200154905092915050565b600054610100900460ff1680614e405750614e40614297565b80614e4e575060005460ff16155b614e6a5760405162461bcd60e51b8152600401610c5c90615fb1565b600054610100900460ff16158015614e95576000805460ff1961ff0019909116610100171660011790555b6038805460ff60a01b1916600160a01b1790558015612ff1576000805461ff001916905550565b60008181526001830160205260408120548015614f785783546000198083019190810190600090879083908110614eef57fe5b9060005260206000200154905080876000018481548110614f0c57fe5b600091825260208083209091019290925582815260018981019092526040902090840190558654879080614f3c57fe5b60019003818190600052602060002001600090559055866001016000878152602001908152602001600020600090556001945050505050612059565b6000915050612059565b60009081526001919091016020526040902054151590565b828054828255906000526020600020908101928215614fed579160200282015b82811115614fed5781546001600160a01b0319166001600160a01b03843516178255602090920191600190910190614fba565b50614ff992915061515a565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061503e57805160ff191683800117855561506b565b8280016001018555821561506b579182015b8281111561506b578251825591602001919060010190615050565b50614ff9929150615179565b604051806040016040528060008152602001600081525090565b6040518060e0016040528060006001600160a01b031681526020016000815260200160008152602001600081526020016000815260200160008152602001600081525090565b604051806101c0016040528060006001600160a01b0316815260200160006001600160a01b0316815260200160008152602001600081526020016000815260200160008152602001600081526020016000815260200160008152602001600081526020016000815260200160008152602001600081526020016000151581525090565b5b80821115614ff95780546001600160a01b031916815560010161515b565b5b80821115614ff9576000815560010161517a565b80356001600160a01b038116811461205957600080fd5b60008083601f8401126151b6578182fd5b50813567ffffffffffffffff8111156151cd578182fd5b60208301915083602080830285010111156151e757600080fd5b9250929050565b600082601f8301126151fe578081fd5b813567ffffffffffffffff80821115615215578283fd5b604051601f8301601f191681016020018281118282101715615235578485fd5b60405282815292508284830160200186101561525057600080fd5b8260208601602083013760006020848301015250505092915050565b60006020828403121561527d578081fd5b612056838361518e565b60008060408385031215615299578081fd5b6152a3848461518e565b91506152b2846020850161518e565b90509250929050565b600080600080600080600060e0888a0312156152d5578283fd5b87356001600160a01b03811681146152eb578384fd5b96506152fa8960208a0161518e565b95506040880135945060608801359350608088013567ffffffffffffffff80821115615324578485fd5b6153308b838c016151ee565b945060a08a0135915080821115615345578384fd5b6153518b838c016151ee565b935060c08a0135915080821115615366578283fd5b506153738a828b016151ee565b91505092959891949750929550565b60008060408385031215615394578182fd5b61539e848461518e565b915060208301356153ae816164e6565b809150509250929050565b600080600080608085870312156153ce578384fd5b6153d8868661518e565b9350602085013567ffffffffffffffff808211156153f4578485fd5b615400888389016151ee565b94506040870135915080821115615415578384fd5b615421888389016151ee565b93506060870135915080821115615436578283fd5b50615443878288016151ee565b91505092959194509250565b60008060408385031215615461578182fd5b61546b848461518e565b946020939093013593505050565b6000806020838503121561548b578182fd5b823567ffffffffffffffff8111156154a1578283fd5b6154ad858286016151a5565b90969095509350505050565b6000806000806000806000806000806000806101208d8f0312156154db578485fd5b67ffffffffffffffff8d3511156154f0578485fd5b6154fd8e8e358f016151a5565b909c509a5067ffffffffffffffff60208e0135111561551a578485fd5b61552a8e60208f01358f016151a5565b909a50985067ffffffffffffffff60408e01351115615547578485fd5b6155578e60408f01358f016151a5565b90985096506155698e60608f0161518e565b95506155788e60808f0161518e565b94506155878e60a08f0161518e565b93506155968e60c08f0161518e565b92506155a58e60e08f0161518e565b91506101008d013590509295989b509295989b509295989b565b6000602082840312156155d0578081fd5b8151612056816164e6565b6000602082840312156155ec578081fd5b5035919050565b600060208284031215615604578081fd5b5051919050565b6000806040838503121561561d578182fd5b823591506152b2846020850161518e565b60008060408385031215615640578182fd5b823591506020830135600281106153ae578182fd5b60008151808452815b8181101561567a5760208185018101518683018201520161565e565b8181111561568b5782602083870101525b50601f01601f19169290920160200192915050565b60008083546001808216600081146156bf57600181146156d657615705565b60ff198316865260028304607f1686019350615705565b600283048786526020808720875b838110156156fd5781548a8201529085019082016156e4565b505050860193505b509195945050505050565b6001600160a01b0391909116815260200190565b6001600160a01b03929092168252602082015260400190565b6020808252825182820181905260009190848201906040850190845b8181101561577e5783516001600160a01b031683529284019291840191600101615759565b50909695505050505050565b602080825282518282018190526000919060409081850190868401855b8281101561580857815180516001600160a01b0316855286810151878601528581015186860152606080820151908601526080808201519086015260a0808201519086015260c0908101519085015260e090930192908501906001016157a7565b5091979650505050505050565b901515815260200190565b6000602082526120566020830184615655565b6000606082526158466060830186615655565b82810360208401526158588186615655565b9050828103604084015261586c8185615655565b9695505050505050565b60208082526028908201527f56616c696461746f72733a206e6f20656e6f7567682062616c6c6f747320746f604082015267103932bb37b5b29760c11b606082015260800190565b60208082526022908201527f456e756d657261626c655365743a20696e646578206f7574206f6620626f756e604082015261647360f01b606082015260800190565b60208082526022908201527f696e76616c69642076616c696461746f7220616e642069742773206d616e616760408201526132b960f11b606082015260800190565b6020808252600c908201526b1b9bc81cdd58da081c1bdbdb60a21b604082015260600190565b6020808252600d908201526c36bab9ba1031329030b236b4b760991b604082015260600190565b6020808252603d908201527f6f6e6c792076616c696461746f7220696e207468652070726f706f73616c206f60408201527f722061646d696e2063616e2063616c6c2061646456616c696461746f72000000606082015260800190565b6020808252603a908201527f56616c696461746f72733a206f6e6c79206d616e61676572206f66207468652060408201527f706f6f6c2063616e20636c61696d206665652072657761726473000000000000606082015260800190565b60208082526010908201526f426c6f636b2065706f6368206f6e6c7960801b604082015260600190565b6020808252601b908201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604082015260600190565b60208082526034908201527f56616c696461746f72733a20766f746573206d75737420626520696e74656765604082015273391036bab63a34b836329037b310189025a1a99760611b606082015260800190565b60208082526024908201527f6e6f20656e6f756768206b637320696e2076616c696461746f727320636f6e746040820152631c9858dd60e21b606082015260800190565b6020808252601b908201527f56616c696461746f72733a20696e76616c696420616d6f756e742e0000000000604082015260600190565b60208082526024908201527f6f7065726174696f6e206973206f6e6c7920616c6c6f776564206279206d616e60408201526330b3b2b960e11b606082015260800190565b6020808252603a908201527f416464726573733a20756e61626c6520746f2073656e642076616c75652c207260408201527f6563697069656e74206d61792068617665207265766572746564000000000000606082015260800190565b60208082526031908201527f63616e6e6f742062652063616c6c6564206d6f7265207468616e206f6e636520604082015270696e20612073696e676c6520626c6f636b60781b606082015260800190565b602080825260139082015272141bdbdb08191bd95cc81b9bdd08195e1a5cdd606a1b604082015260600190565b6020808252601d908201527f416464726573733a20696e73756666696369656e742062616c616e6365000000604082015260600190565b6020808252602d908201527f746865207265766f6b696e6720616d6f756e74206d757374206265206772656160408201526c746572207468616e207a65726f60981b606082015260800190565b60208082526017908201527f6465736372697074696f6e20697320746f6f206c6f6e67000000000000000000604082015260600190565b602080825260409082018190527f706f6f6c20646f6573206e6f74206578697374206f72206d73672e73656e6465908201527f72206973206e6f7420746865206d616e61676572206f662074686520706f6f6c606082015260800190565b6020808252602f908201527f56616c696461746f72733a206f6e652074696d65206f66206368616e6765207760408201526e34ba3434b710191a103437bab9399760891b606082015260800190565b60208082526038908201527f56616c696461746f72733a20746f74616c417661696c61626c65206973206c6560408201527f7373207468616e20746f74616c44697374726962757465640000000000000000606082015260800190565b602080825260119082015270656d61696c20697320746f6f206c6f6e6760781b604082015260600190565b6020808252601e908201527f696e76616c6964206c656e677468206f66206e65775365742061727261790000604082015260600190565b6020808252601690820152751c1c9bdc1bdcd85b081a5cc81b9bdd081c185cdcd95960521b604082015260600190565b60208082526021908201527f536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f6040820152607760f81b606082015260800190565b6020808252603b908201527f56616c696461746f72733a2074686520666565207368617265732073686f756c60408201527f6420626520696e207468652072616e676528302e2e33303030292e0000000000606082015260800190565b6020808252600a90820152694d696e6572206f6e6c7960b01b604082015260600190565b6020808252602e908201527f436f6e747261637420696e7374616e63652068617320616c726561647920626560408201526d195b881a5b9a5d1a585b1a5e995960921b606082015260800190565b60208082526027908201527f56616c696461746f72733a206e6f2070656e64696e672072657761726420746f6040820152661031b630b4b69760c91b606082015260800190565b60208082526027908201527f6f6e6c792074686520706f6f6c206d616e616765722063616e20636c61696d206040820152667265776172647360c81b606082015260800190565b60208082526019908201527f56616c696461746f72733a205a45524f5f414444524553532e00000000000000604082015260600190565b6020808252601f908201527f56616c696461746f72733a204e6f206368616e67652064657465637465642e00604082015260600190565b60208082526032908201527f6d73672e76616c7565206d75737420626520616e20696e7465676572206d756c6040820152713a34b836329037b31030b71032ba3432b91760711b606082015260800190565b6020808252601390820152721c1bdbdb081a5cc81b9bdd08195b98589b1959606a1b604082015260600190565b6020808252601f908201527f56616c696461746f72733a206e6f206368616e67652064657465637465642e00604082015260600190565b6020808252601a908201527f6f6e6c79206d616e616765722063616e206368616e6765206974000000000000604082015260600190565b602080825260119082015270185b1c9958591e481c9958dbdd995c9959607a1b604082015260600190565b60208082526014908201527350756e69736820636f6e7472616374206f6e6c7960601b604082015260600190565b60208082526027908201527f56616c696461746f72733a206d7573742072657175697265206d696e53656c6660408201526642616c6c6f747360c81b606082015260800190565b6020808252601390820152727765627369746520697320746f6f206c6f6e6760681b604082015260600190565b60208082526019908201527f70726f706f73616c2063616e6e6f742062652072657573656400000000000000604082015260600190565b6020808252601f908201527f5265656e7472616e637947756172643a207265656e7472616e742063616c6c00604082015260600190565b6020808252602b908201527f56616c696461746f72733a206e6f2070656e64696e672066656520726577617260408201526a32103a379031b630b4b69760a91b606082015260800190565b60208082526030908201527f56616c696461746f72733a2072656465656d20616d6f756e74206d757374206260408201526f0652067726561746572207468616e20360841b606082015260800190565b6020808252601c908201527f616c7265616479206861766520616e20656e61626c656420706f6f6c00000000604082015260600190565b60208082526038908201527f76616c696461746f722063616e206f6e6c7920766f746520746f2068696d736560408201527f6c66206279206465706f736974696e67206d617267696e2e0000000000000000606082015260800190565b602080825260409082018190527f56616c696461746f72733a206e6f2062616c6c6f747320746f20776974686472908201527f6177206f722062616c6c6f747320617265207374696c6c206c6f636b696e672e606082015260800190565b61ffff91909116815260200190565b90815260200190565b9182521515602082015260400190565b918252602082015260400190565b8015158114612ff157600080fdfea26469706673582212203a23a2955e752d03e9ee1a3f95d77f0d4daedf07d7c677068c1f4de0192c362c64736f6c634300060c0033")

	state.SetCode(IshikariValidatorsContractAddr, newCode)

}

// The patches for kcc peg token:
//   - upgrade the peg token contract code to commit "#e8f1655"
//
// The patch is not the same for mainnet and testnet
func patchKCCPegToken(chainID *big.Int, state codeSetter) {

	// The addresses of the peg token contracts (mainnet)
	mainnetContracts := []common.Address{
		common.HexToAddress("0x0039f574eE5cC39bdD162E9A88e3EB1f111bAF48"), // USDT
		common.HexToAddress("0x980a5AfEf3D17aD98635F6C5aebCBAedEd3c3430"), // USDC
		common.HexToAddress("0xfA93C12Cd345c658bc4644D1D4E1B9615952258C"), // BTCK
		common.HexToAddress("0xf55aF137A98607F7ED2eFEfA4cd2DfE70E4253b1"), // ETH
		common.HexToAddress("0x1B8e27ABA297466fc6765Ce55BD12A8E216759da"), // Polygon Matic
	}

	// The addresses of the peg token contracts (testnet)
	testnetContracts := []common.Address{
		common.HexToAddress("0x67f6a7BbE0da067A747C6b2bEdF8aBBF7D6f60dc"), // USDT
		common.HexToAddress("0xD6c7E27a598714c2226404Eb054e0c074C906Fc9"), // USDC
		common.HexToAddress("0xF8Cb9f1D136Ff4c883320b5B4fa80048b888F459"), // ETH
		common.HexToAddress("0xf57a7eE19a628e4d475b72d6c9DD847c50636e01"), // BTC
	}

	// The contracts to be patched
	targetContracts := mainnetContracts

	if chainID.Cmp(big.NewInt(2345)) == 0 {
		targetContracts = testnetContracts
	}

	// appy the patch

	newCode := common.FromHex("0x608060405234801561001057600080fd5b50600436106101f05760003560e01c806379cc67901161010f578063a9059cbb116100a2578063dd62ed3e11610071578063dd62ed3e14610614578063e47d606014610642578063e63ab1e914610668578063f515e6f214610670576101f0565b8063a9059cbb14610597578063ca15c873146105c3578063d5391393146105e0578063d547741f146105e8576101f0565b806391d14854116100de57806391d148541461052f57806395d89b411461055b578063a217fddf14610563578063a457c2d71461056b576101f0565b806379cc67901461049657806379da7e59146104c25780638456cb59146104e85780639010d07c146104f0576101f0565b806336568abe1161018757806342966c681161015657806342966c68146104255780635c975abb1461044257806370a082311461044a5780637270024114610470576101f0565b806336568abe1461039957806339509351146103c55780633f4ba83a146103f157806340c10f19146103f9576101f0565b806323b872dd116101c357806323b872dd146102fa578063248a9ca3146103305780632f2ff15d1461034d578063313ce5671461037b576101f0565b806306fdde03146101f5578063095ea7b3146102725780631068361f146102b257806318160ddd146102f2575b600080fd5b6101fd610678565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561023757818101518382015260200161021f565b50505050905090810190601f1680156102645780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b61029e6004803603604081101561028857600080fd5b506001600160a01b03813516906020013561070e565b604080519115158252519081900360200190f35b6102e0600480360360408110156102c857600080fd5b506001600160a01b038135811691602001351661072c565b60408051918252519081900360200190f35b6102e0610885565b61029e6004803603606081101561031057600080fd5b506001600160a01b0381358116916020810135909116906040013561088b565b6102e06004803603602081101561034657600080fd5b5035610912565b6103796004803603604081101561036357600080fd5b50803590602001356001600160a01b0316610927565b005b610383610993565b6040805160ff9092168252519081900360200190f35b610379600480360360408110156103af57600080fd5b50803590602001356001600160a01b031661099c565b61029e600480360360408110156103db57600080fd5b506001600160a01b0381351690602001356109fd565b610379610a4b565b6103796004803603604081101561040f57600080fd5b506001600160a01b038135169060200135610abc565b6103796004803603602081101561043b57600080fd5b5035610b2d565b61029e610b41565b6102e06004803603602081101561046057600080fd5b50356001600160a01b0316610b4a565b6103796004803603602081101561048657600080fd5b50356001600160a01b0316610b65565b610379600480360360408110156104ac57600080fd5b506001600160a01b038135169060200135610c18565b610379600480360360208110156104d857600080fd5b50356001600160a01b0316610c72565b610379610d22565b6105136004803603604081101561050657600080fd5b5080359060200135610d91565b604080516001600160a01b039092168252519081900360200190f35b61029e6004803603604081101561054557600080fd5b50803590602001356001600160a01b0316610db0565b6101fd610dc8565b6102e0610e29565b61029e6004803603604081101561058157600080fd5b506001600160a01b038135169060200135610e2e565b61029e600480360360408110156105ad57600080fd5b506001600160a01b038135169060200135610e96565b6102e0600480360360208110156105d957600080fd5b5035610eaa565b6102e0610ec1565b610379600480360360408110156105fe57600080fd5b50803590602001356001600160a01b0316610ee5565b6102e06004803603604081101561062a57600080fd5b506001600160a01b0381358116916020013516610f3e565b61029e6004803603602081101561065857600080fd5b50356001600160a01b0316610f69565b6102e0610f87565b6102e0610fab565b60038054604080516020601f60026000196101006001881615020190951694909404938401819004810282018101909252828152606093909290918301828280156107045780601f106106d957610100808354040283529160200191610704565b820191906000526020600020905b8154815290600101906020018083116106e757829003601f168201915b5050505050905090565b600061072261071b610fe4565b8484610fe8565b5060015b92915050565b60003373fa56aa4fc52623935c0e93a4d7ef79b9d5c951c8146107805760405162461bcd60e51b8152600401808060200182810382526021815260200180611b8b6021913960400191505060405180910390fd5b6000836001600160a01b03166370a08231306040518263ffffffff1660e01b815260040180826001600160a01b0316815260200191505060206040518083038186803b1580156107cf57600080fd5b505afa1580156107e3573d6000803e3d6000fd5b505050506040513d60208110156107f957600080fd5b50516040805163a9059cbb60e01b81526001600160a01b0386811660048301526024820184905291519293509086169163a9059cbb916044808201926020929091908290030181600087803b15801561085157600080fd5b505af1158015610865573d6000803e3d6000fd5b505050506040513d602081101561087b57600080fd5b5090949350505050565b60025490565b60006108988484846110d4565b610908846108a4610fe4565b61090385604051806060016040528060288152602001611bdc602891396001600160a01b038a166000908152600160205260408120906108e2610fe4565b6001600160a01b03168152602081019190915260400160002054919061122f565b610fe8565b5060019392505050565b60009081526006602052604090206002015490565b60008281526006602052604090206002015461094a90610945610fe4565b610db0565b6109855760405162461bcd60e51b815260040180806020018281038252602f815260200180611a85602f913960400191505060405180910390fd5b61098f82826112c6565b5050565b60055460ff1690565b6109a4610fe4565b6001600160a01b0316816001600160a01b0316146109f35760405162461bcd60e51b815260040180806020018281038252602f815260200180611d50602f913960400191505060405180910390fd5b61098f828261132f565b6000610722610a0a610fe4565b846109038560016000610a1b610fe4565b6001600160a01b03908116825260208083019390935260409182016000908120918c168152925290205490611398565b610a777f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a610945610fe4565b610ab25760405162461bcd60e51b815260040180806020018281038252602f815260200180611af8602f913960400191505060405180910390fd5b610aba6113f2565b565b610ae87f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a6610945610fe4565b610b235760405162461bcd60e51b815260040180806020018281038252602c815260200180611cd2602c913960400191505060405180910390fd5b61098f8282611492565b610b3e610b38610fe4565b82611582565b50565b60075460ff1690565b6001600160a01b031660009081526020819052604090205490565b610b917f98db8a220cd0f09badce9f22d0ba7e93edb3d404448cc3560d391ab096ad16e9610945610fe4565b610bcc5760405162461bcd60e51b815260040180806020018281038252603e815260200180611b4d603e913960400191505060405180910390fd5b6001600160a01b038116600081815260086020526040808220805460ff19166001179055517f7fd26be6fc92aff63f1f4409b2b2ddeb272a888031d7f55ec830485ec61941869190a250565b6000610c4f82604051806060016040528060248152602001611c0460249139610c4886610c43610fe4565b610f3e565b919061122f565b9050610c6383610c5d610fe4565b83610fe8565b610c6d8383611582565b505050565b610c9e7f98db8a220cd0f09badce9f22d0ba7e93edb3d404448cc3560d391ab096ad16e9610945610fe4565b610cd95760405162461bcd60e51b8152600401808060200182810382526040815260200180611c6e6040913960400191505060405180910390fd5b6001600160a01b038116600081815260086020526040808220805460ff19169055517fcdd762171e068b4051cab8b4813f8783756ae1a3d4d379ec5c82d05650c54f1d9190a250565b610d4e7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a610945610fe4565b610d895760405162461bcd60e51b815260040180806020018281038252602d815260200180611cfe602d913960400191505060405180910390fd5b610aba61167e565b6000828152600660205260408120610da99083611701565b9392505050565b6000828152600660205260408120610da9908361170d565b60048054604080516020601f60026000196101006001881615020190951694909404938401819004810282018101909252828152606093909290918301828280156107045780601f106106d957610100808354040283529160200191610704565b600081565b6000610722610e3b610fe4565b8461090385604051806060016040528060258152602001611d2b6025913960016000610e65610fe4565b6001600160a01b03908116825260208083019390935260409182016000908120918d1681529252902054919061122f565b6000610722610ea3610fe4565b84846110d4565b600081815260066020526040812061072690611722565b7f9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a681565b600082815260066020526040902060020154610f0390610945610fe4565b6109f35760405162461bcd60e51b8152600401808060200182810382526030815260200180611bac6030913960400191505060405180910390fd5b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b6001600160a01b031660009081526008602052604090205460ff1690565b7f65d7a28e3265b37a6474929f336521b332c1681b933f6cb9f3376673440d862a81565b7f98db8a220cd0f09badce9f22d0ba7e93edb3d404448cc3560d391ab096ad16e981565b6000610da9836001600160a01b03841661172d565b3390565b6001600160a01b03831661102d5760405162461bcd60e51b8152600401808060200182810382526024815260200180611cae6024913960400191505060405180910390fd5b6001600160a01b0382166110725760405162461bcd60e51b8152600401808060200182810382526022815260200180611ad66022913960400191505060405180910390fd5b6001600160a01b03808416600081815260016020908152604080832094871680845294825291829020859055815185815291517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259281900390910190a3505050565b6001600160a01b0383166111195760405162461bcd60e51b8152600401808060200182810382526025815260200180611c496025913960400191505060405180910390fd5b6001600160a01b03821661115e5760405162461bcd60e51b8152600401808060200182810382526023815260200180611a626023913960400191505060405180910390fd5b611169838383611777565b6111a681604051806060016040528060268152602001611b27602691396001600160a01b038616600090815260208190526040902054919061122f565b6001600160a01b0380851660009081526020819052604080822093909355908416815220546111d59082611398565b6001600160a01b038084166000818152602081815260409182902094909455805185815290519193928716927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef92918290030190a3505050565b600081848411156112be5760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b8381101561128357818101518382015260200161126b565b50505050905090810190601f1680156112b05780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b505050900390565b60008281526006602052604090206112de9082610fcf565b1561098f576112eb610fe4565b6001600160a01b0316816001600160a01b0316837f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a45050565b60008281526006602052604090206113479082611838565b1561098f57611354610fe4565b6001600160a01b0316816001600160a01b0316837ff6391f5c32d9c69d2a47ea670b442974b53935d1edc7fd64eb21e047a839171b60405160405180910390a45050565b600082820183811015610da9576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b6113fa610b41565b611442576040805162461bcd60e51b815260206004820152601460248201527314185d5cd8589b194e881b9bdd081c185d5cd95960621b604482015290519081900360640190fd5b6007805460ff191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa611475610fe4565b604080516001600160a01b039092168252519081900360200190a1565b6001600160a01b0382166114ed576040805162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f206164647265737300604482015290519081900360640190fd5b6114f960008383611777565b6002546115069082611398565b6002556001600160a01b03821660009081526020819052604090205461152c9082611398565b6001600160a01b0383166000818152602081815260408083209490945583518581529351929391927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9281900390910190a35050565b6001600160a01b0382166115c75760405162461bcd60e51b8152600401808060200182810382526021815260200180611c286021913960400191505060405180910390fd5b6115d382600083611777565b61161081604051806060016040528060228152602001611ab4602291396001600160a01b038516600090815260208190526040902054919061122f565b6001600160a01b038316600090815260208190526040902055600254611636908261184d565b6002556040805182815290516000916001600160a01b038516917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360200190a35050565b611686610b41565b156116cb576040805162461bcd60e51b815260206004820152601060248201526f14185d5cd8589b194e881c185d5cd95960821b604482015290519081900360640190fd5b6007805460ff191660011790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a258611475610fe4565b6000610da983836118aa565b6000610da9836001600160a01b03841661190e565b600061072682611926565b6000611739838361190e565b61176f57508154600181810184556000848152602080822090930184905584548482528286019093526040902091909155610726565b506000610726565b61178283838361192a565b61178b83610f69565b156117dd576040805162461bcd60e51b815260206004820152601d60248201527f4552433230506567546f6b656e3a20696e76616c69642073656e646572000000604482015290519081900360640190fd5b6117e682610f69565b15610c6d576040805162461bcd60e51b815260206004820181905260248201527f4552433230506567546f6b656e3a20696e76616c696420726563697069656e74604482015290519081900360640190fd5b6000610da9836001600160a01b038416611979565b6000828211156118a4576040805162461bcd60e51b815260206004820152601e60248201527f536166654d6174683a207375627472616374696f6e206f766572666c6f770000604482015290519081900360640190fd5b50900390565b815460009082106118ec5760405162461bcd60e51b8152600401808060200182810382526022815260200180611a406022913960400191505060405180910390fd5b8260000182815481106118fb57fe5b9060005260206000200154905092915050565b60009081526001919091016020526040902054151590565b5490565b611935838383610c6d565b61193d610b41565b15610c6d5760405162461bcd60e51b815260040180806020018281038252602a815260200180611d7f602a913960400191505060405180910390fd5b60008181526001830160205260408120548015611a3557835460001980830191908101906000908790839081106119ac57fe5b90600052602060002001549050808760000184815481106119c957fe5b6000918252602080832090910192909255828152600189810190925260409020908401905586548790806119f957fe5b60019003818190600052602060002001600090559055866001016000878152602001908152602001600020600090556001945050505050610726565b600091505061072656fe456e756d657261626c655365743a20696e646578206f7574206f6620626f756e647345524332303a207472616e7366657220746f20746865207a65726f2061646472657373416363657373436f6e74726f6c3a2073656e646572206d75737420626520616e2061646d696e20746f206772616e7445524332303a206275726e20616d6f756e7420657863656564732062616c616e636545524332303a20617070726f766520746f20746865207a65726f20616464726573734552433230506567546f6b656e3a206d75737420686176652070617573657220726f6c6520746f20756e706175736545524332303a207472616e7366657220616d6f756e7420657863656564732062616c616e63654552433230506567546f6b656e3a206d757374206861766520626c61636b6c697374657220726f6c6520746f207365742074686520626c61636b6c6973744552433230506567546f6b656e3a206f6e6c79206d69677261746f7220726f6c65416363657373436f6e74726f6c3a2073656e646572206d75737420626520616e2061646d696e20746f207265766f6b6545524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636545524332303a206275726e20616d6f756e74206578636565647320616c6c6f77616e636545524332303a206275726e2066726f6d20746865207a65726f206164647265737345524332303a207472616e736665722066726f6d20746865207a65726f20616464726573734552433230506567546f6b656e3a206d757374206861766520626c61636b6c697374657220726f6c6520746f20756e7365742074686520626c61636b6c69737445524332303a20617070726f76652066726f6d20746865207a65726f20616464726573734552433230506567546f6b656e3a206d7573742068617665206d696e74657220726f6c6520746f206d696e744552433230506567546f6b656e3a206d75737420686176652070617573657220726f6c6520746f20706175736545524332303a2064656372656173656420616c6c6f77616e63652062656c6f77207a65726f416363657373436f6e74726f6c3a2063616e206f6e6c792072656e6f756e636520726f6c657320666f722073656c6645524332305061757361626c653a20746f6b656e207472616e73666572207768696c6520706175736564a264697066735822122019d4b78b45cee9c4431c386a85bcd4901a527860dafbf39bd68c77dbaed87e1f64736f6c634300060c0033")

	for _, addr := range targetContracts {
		state.SetCode(addr, newCode)
	}

}
